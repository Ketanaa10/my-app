import React, { useState, useEffect, createContext, useContext } from "react";
import { BrowserRouter, Routes, Route, Link, useNavigate } from "react-router-dom";
import axios from "axios";

// ğŸŒ Global Context
const AppContext = createContext();

const AppProvider = ({ children }) => {
  const [darkMode, setDarkMode] = useState(localStorage.getItem("darkMode") === "true");
  const [homestays, setHomestays] = useState([]);
  const [attractions, setAttractions] = useState([]);
  const [favorites, setFavorites] = useState(JSON.parse(localStorage.getItem("favorites")) || []);

  // Fetch mock data
  useEffect(() => {
    axios
      .get("https://mocki.io/v1/9b5c95e5-d6c3-4951-bb91-18cfb1476e22")
      .then((res) => {
        setHomestays(res.data.homestays);
        setAttractions(res.data.attractions);
      })
      .catch(() => {
        setHomestays([
          { id: 1, name: "Green Valley Homestay", location: "Coorg", price: 1500 },
          { id: 2, name: "Himalayan Retreat", location: "Manali", price: 2000 },
          { id: 3, name: "Beach View Cottage", location: "Goa", price: 2500 },
        ]);
        setAttractions([
          { id: 1, name: "Abbey Falls", location: "Coorg" },
          { id: 2, name: "Solang Valley", location: "Manali" },
          { id: 3, name: "Baga Beach", location: "Goa" },
        ]);
      });
  }, []);

  useEffect(() => {
    localStorage.setItem("darkMode", darkMode);
    localStorage.setItem("favorites", JSON.stringify(favorites));
  }, [darkMode, favorites]);

  return (
    <AppContext.Provider
      value={{ darkMode, setDarkMode, homestays, attractions, favorites, setFavorites }}
    >
      {children}
    </AppContext.Provider>
  );
};

const useApp = () => useContext(AppContext);



// ğŸŒ Navbar
const Navbar = () => {
  const { darkMode, setDarkMode } = useApp();
  return (
    <nav className="navbar">
      <h2>ğŸ¡ Homestay Explorer</h2>
      <ul>
        <li><Link to="/">Home</Link></li>
        <li><Link to="/homestays">Homestays</Link></li>
        <li><Link to="/attractions">Attractions</Link></li>
        <li><Link to="/guide">Local Insights</Link></li>
        <li><Link to="/host">Host</Link></li>
        <li><Link to="/auth">Authenticate</Link></li>
        <li><Link to="/admin">Admin</Link></li>
      </ul>
      <button onClick={() => setDarkMode(!darkMode)} className="toggle-btn">
        {darkMode ? "â˜€ Light" : "ğŸŒ™ Dark"}
      </button>
    </nav>
  );
};



// ğŸ  Home Page
const Home = () => {
  const navigate = useNavigate();
  return (
    <div className="page home-page">
      <h1>Welcome to Homestay Explorer</h1>
      <p>
        Discover affordable homestays and hidden gems across India.
        Experience travel like a local, guided by real people who live there.
      </p>

      <img
        src="https://images.unsplash.com/photo-1582719478173-2c1eec9b7b5b"
        alt="Homestay"
        className="banner-image"
      />

      <div className="info-grid">
        <div className="info-card" onClick={() => navigate("/guide")}>
          <img
            src="https://images.unsplash.com/photo-1505691938895-1758d7feb511"
            alt="Local Insights"
          />
          <h3>ğŸ’¬ Local Insights</h3>
          <p>Get recommendations and stories from real locals.</p>
        </div>

        <div className="info-card" onClick={() => navigate("/homestays")}>
          <img
            src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c"
            alt="Homestays"
          />
          <h3>ğŸ  Homestays</h3>
          <p>Stay with verified hosts across scenic locations.</p>
        </div>

        <div className="info-card" onClick={() => navigate("/attractions")}>
          <img
            src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e"
            alt="Attractions"
          />
          <h3>ğŸ—º Local Attractions</h3>
          <p>Discover popular and hidden gems nearby.</p>
        </div>
      </div>
    </div>
  );
};



// ğŸ  Homestays Page
const Homestays = () => {
  const { homestays, favorites, setFavorites } = useApp();
  const [search, setSearch] = useState("");

  const filtered = homestays.filter((h) =>
    h.name.toLowerCase().includes(search.toLowerCase())
  );

  const toggleFavorite = (id) => {
    setFavorites((prev) =>
      prev.includes(id) ? prev.filter((f) => f !== id) : [...prev, id]
    );
  };

  return (
    <div className="page">
      <h2>Available Homestays</h2>
      <input
        type="text"
        placeholder="Search homestays..."
        value={search}
        onChange={(e) => setSearch(e.target.value)}
        className="search"
      />
      <div className="grid">
        {filtered.map((home) => (
          <div key={home.id} className="card">
            <h3>{home.name}</h3>
            <p>{home.location}</p>
            <p>â‚¹{home.price}/night</p>
            <button onClick={() => toggleFavorite(home.id)}>
              {favorites.includes(home.id) ? "â¤ Liked" : "ğŸ¤ Like"}
            </button>
          </div>
        ))}
      </div>
    </div>
  );
};



// ğŸ—º Attractions Page
const Attractions = () => {
  const { attractions } = useApp();
  return (
    <div className="page">
      <h2>Nearby Attractions</h2>
      <div className="grid">
        {attractions.map((place) => (
          <div key={place.id} className="card">
            <h3>{place.name}</h3>
            <p>{place.location}</p>
          </div>
        ))}
      </div>
    </div>
  );
};



// ğŸ‘©â€ğŸ’¼ Host Page with Image Upload
const Host = () => {
  const [form, setForm] = useState({ name: "", location: "", price: "", image: null });
  const [submitted, setSubmitted] = useState(false);
  const [preview, setPreview] = useState(null);

  const handleImage = (e) => {
    const file = e.target.files[0];
    if (file) {
      setForm({ ...form, image: file });
      setPreview(URL.createObjectURL(file));
    }
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    console.log("New Homestay:", form);
    setSubmitted(true);
    setForm({ name: "", location: "", price: "", image: null });
    setPreview(null);
  };

  return (
    <div className="page">
      <h2>Host Dashboard</h2>
      <p>List and manage your homestays here.</p>
      <form onSubmit={handleSubmit} className="form">
        <input
          type="text"
          placeholder="Homestay Name"
          value={form.name}
          onChange={(e) => setForm({ ...form, name: e.target.value })}
          required
        />
        <input
          type="text"
          placeholder="Location"
          value={form.location}
          onChange={(e) => setForm({ ...form, location: e.target.value })}
          required
        />
        <input
          type="number"
          placeholder="Price per night"
          value={form.price}
          onChange={(e) => setForm({ ...form, price: e.target.value })}
          required
        />
        <input type="file" accept="image/*" onChange={handleImage} />
        {preview && <img src={preview} alt="Preview" className="preview-img" />}
        <button type="submit">Add Homestay</button>
      </form>
      {submitted && <p style={{ color: "green" }}>Homestay added successfully!</p>}
    </div>
  );
};



// ğŸªª Authentication Page (Host ID Upload)
const AuthPage = () => {
  const [idFile, setIdFile] = useState(null);
  const [preview, setPreview] = useState(null);
  const [submitted, setSubmitted] = useState(false);

  const handleFile = (e) => {
    const file = e.target.files[0];
    setIdFile(file);
    setPreview(URL.createObjectURL(file));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    setSubmitted(true);
    console.log("Uploaded ID:", idFile);
  };

  return (
    <div className="page">
      <h2>ğŸ” Host Verification</h2>
      <p>Please upload your government ID before listing your homestay.</p>
      <form onSubmit={handleSubmit} className="form">
        <input type="file" accept="image/*" onChange={handleFile} required />
        {preview && <img src={preview} alt="ID Preview" className="preview-img" />}
        <button type="submit">Upload ID</button>
      </form>
      {submitted && <p style={{ color: "green" }}>ID uploaded successfully!</p>}
    </div>
  );
};



// ğŸ’¬ Guide Page
const Guide = () => (
  <div className="page">
    <h2>Local Insights</h2>
    <p>Explore authentic experiences shared by locals.</p>
    <ul style={{ textAlign: "left", margin: "auto", width: "60%" }}>
      <li>ğŸ Best trekking routes in Coorg.</li>
      <li>ğŸ› Must-try local dishes in Manali.</li>
      <li>ğŸ¨ Art and craft markets in Goa.</li>
      <li>ğŸ– Hidden beaches known only by locals.</li>
    </ul>
  </div>
);



// ğŸ§‘â€ğŸ’¼ Admin Page
const Admin = () => (
  <div className="page">
    <h2>Admin Panel</h2>
    <p>Manage users, listings, and reviews.</p>
    <div className="grid">
      <div className="card">
        <h3>ğŸ‘¥ Users</h3>
        <p>Manage accounts and access levels.</p>
      </div>
      <div className="card">
        <h3>ğŸ  Listings</h3>
        <p>Review and approve new homestay listings.</p>
      </div>
      <div className="card">
        <h3>â­ Reviews</h3>
        <p>Monitor traveler and host feedback.</p>
      </div>
    </div>
  </div>
);



// ğŸŒ— Root App
const App = () => {
  const { darkMode } = useApp();
  return (
    <div className={darkMode ? "dark" : "light"}>
      <Navbar />
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/homestays" element={<Homestays />} />
        <Route path="/attractions" element={<Attractions />} />
        <Route path="/guide" element={<Guide />} />
        <Route path="/host" element={<Host />} />
        <Route path="/auth" element={<AuthPage />} />
        <Route path="/admin" element={<Admin />} />
      </Routes>
    </div>
  );
};



// ğŸš€ Main Export
export default function WrappedApp() {
  return (
    <AppProvider>
      <BrowserRouter>
        <App />
      </BrowserRouter>
    </AppProvider>
  );
}